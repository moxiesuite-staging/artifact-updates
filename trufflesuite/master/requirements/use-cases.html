

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Saving new artifacts and updating existing &mdash; Proposal: New Truffle Artifacts Format  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Proposal: New Truffle Artifacts Format
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use-cases.html">Use Cases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Proposal: New Truffle Artifacts Format</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>1. Saving new artifacts and updating existing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/requirements/use-cases.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="saving-new-artifacts-and-updating-existing">
<h1>1. Saving new artifacts and updating existing<a class="headerlink" href="#saving-new-artifacts-and-updating-existing" title="Permalink to this headline">¶</a></h1>
<p>Users and tooling must be able to save new and update existing <a class="reference internal" href="../glossary.html#term-artifact"><span class="xref std std-term">Artifact</span></a>
files.</p>
<p>As a core behavior, tooling must facilitate the internal record-keeping of all
known <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a> and <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a>, updating them appropriately
when they change.</p>
<p>Beyond that, developers may also need to manually generate new artifacts for
previously unknown contracts.</p>
<p>Since a smart contract blockchain network is effectively a distributed global
database, developers may write their applications for the express or implicit
purpose of accessing other contract instances on that network.</p>
<p>Developers should be able to leverage tooling to interface with these external
contracts, including public libraries and contract instances for other
applications. Tooling should integrate well with code written outside a given
project.</p>
<p>Additionally, some applications may not use tooling’s built-in deployment
systems, and some <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> may deploy others. Tooling should be
able to account for the record-keeping in all these cases.</p>
<p class="plantuml">
<object data="../_images/plantuml-1a5a1fbfa193dece57542d155013bbbd56440f30.svg" type="image/svg+xml" style="width:457px;height:350px;">
<img src="../_images/plantuml-1a5a1fbfa193dece57542d155013bbbd56440f30.png" alt="left to right direction

:Smart Contract Developer: as :SmartContractDev:

rectangle Saving {
  (Save contract type) as (SaveType)
  (Save contract instance) as (SaveInstance)
  (Save library instance) as (SaveLibrary)
  (Save interface instance) as (SaveInterface)
}

SmartContractDev -- SaveType
SmartContractDev -- SaveInstance
SmartContractDev -- SaveLibrary
SmartContractDev -- SaveInterface" />

</object></p>
<div class="section" id="save-contract-type">
<h2>1.1. Save contract type<a class="headerlink" href="#save-contract-type" title="Permalink to this headline">¶</a></h2>
<p>Users must be able to save a new <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>, whether or not it has any
corresponding <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a>.</p>
</div>
<div class="section" id="save-contract-instance">
<h2>1.2. Save contract instance<a class="headerlink" href="#save-contract-instance" title="Permalink to this headline">¶</a></h2>
<p>Users must be able to save new <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> on a given network,
identifying them as a known <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>.</p>
</div>
<div class="section" id="save-library-instance">
<h2>1.3. Save library instance<a class="headerlink" href="#save-library-instance" title="Permalink to this headline">¶</a></h2>
<p>Similarly, users must be able to save records of externally-deployed
<a class="reference internal" href="../glossary.html#term-library"><span class="xref std std-term">Libraries</span></a>. This is particularly useful, as many commonly-used libraries are
already deployed on a majority of <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Networks</span></a>, and users should not have to pay
the extra gas just to accommodate tooling.</p>
</div>
<div class="section" id="save-interface-instance">
<h2>1.4. Save interface instance<a class="headerlink" href="#save-interface-instance" title="Permalink to this headline">¶</a></h2>
<p>In cases where source is not known for an external contract, users may need to
reference that <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> by its interface (i.e. via Solidity’s
<code class="docutils literal notranslate"><span class="pre">interface</span></code> mechanism).</p>
</div>
</div>
<div class="section" id="compiling-smart-contracts">
<h1>2. Compiling smart contracts<a class="headerlink" href="#compiling-smart-contracts" title="Permalink to this headline">¶</a></h1>
<p>At the core of smart contract development and deployment is the compilation
of high-level languages to the underlying EVM <a class="reference internal" href="../glossary.html#term-bytecode"><span class="xref std std-term">Bytecode</span></a>.</p>
<p>Smart contract developers compile/recompile <a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Sources</span></a> many times throughout
the lifecycle of development.</p>
<p class="plantuml">
<object data="../_images/plantuml-786a0da359be7485c96130d8f15d36df7e807de5.svg" type="image/svg+xml" style="width:701px;height:348px;">
<img src="../_images/plantuml-786a0da359be7485c96130d8f15d36df7e807de5.png" alt="scale 0.80
left to right direction

:Smart Contract Developer: as :Developer:

rectangle Saving &lt;&lt; external &gt;&gt; {
  (Save contract type) as (SaveType)
}

rectangle Compilation {
  (Compile all project sources) as (CompileAll)

  (Determine modified sources) as (DetermineModified)
  (Compile modified project sources) as (CompileModified)
  CompileModified -&gt; DetermineModified

  (Compile source file) as (Compile)
  Compile -&gt; SaveType

  (Compile primary and related source files) as (CompileMultiple)
  CompileMultiple .|&gt; Compile

  CompileAll --&gt; Compile
  CompileModified --&gt; Compile
}

Developer -- CompileAll
Developer -- CompileModified" />

</object></p>
<div class="section" id="compile-all-project-sources">
<h2>2.1. Compile all project sources<a class="headerlink" href="#compile-all-project-sources" title="Permalink to this headline">¶</a></h2>
<p>Either as part of the first development iteration, or to reset, developers must
be able to compile all <a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Source</span></a> files in a <a class="reference internal" href="../glossary.html#term-project"><span class="xref std std-term">Project</span></a> and obtain saved
<a class="reference internal" href="../glossary.html#term-artifact"><span class="xref std std-term">Artifacts</span></a>.</p>
</div>
<div class="section" id="compile-modified-project-sources">
<h2>2.2. Compile modified project sources<a class="headerlink" href="#compile-modified-project-sources" title="Permalink to this headline">¶</a></h2>
<p>For most of development, it’s more commonly useful to compile only <a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Source</span></a>
files that have changed. Users should be able to perform this minimal
compilation.</p>
</div>
<div class="section" id="determine-modified-sources">
<h2>2.3. Determine modified sources<a class="headerlink" href="#determine-modified-sources" title="Permalink to this headline">¶</a></h2>
<p>To support compilation of changed <a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Sources</span></a>, tooling should provide a means to
identify which files have changed since their last compilation.</p>
</div>
<div class="section" id="compile-source-file">
<h2>2.4. Compile source file<a class="headerlink" href="#compile-source-file" title="Permalink to this headline">¶</a></h2>
<p>Tooling must provide a means to compile a single, standalone <a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Source</span></a> file
(no imports), saving a corresponding <a class="reference internal" href="../glossary.html#term-artifact"><span class="xref std std-term">Artifact</span></a> for the <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>.</p>
</div>
<div class="section" id="compile-primary-and-related-source-files">
<h2>2.5. Compile primary and related source files<a class="headerlink" href="#compile-primary-and-related-source-files" title="Permalink to this headline">¶</a></h2>
<p>Tooling must provide a means to compile a single <a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Source</span></a> file and all sources
it imports, recursively.</p>
</div>
</div>
<div class="section" id="reading-contract-metadata">
<h1>3. Reading contract metadata<a class="headerlink" href="#reading-contract-metadata" title="Permalink to this headline">¶</a></h1>
<p>Developers, auditors, business stakeholders, et al., all often need to access
metadata information about both <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a> and <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a>.</p>
<p>For example, stakeholders often need to view the JSON ABI, auditors need source
and compiler information, developers need to maintain records of source file
relations and deployment statuses, etc.</p>
<p>Beyond direct access of contract metadata, many other use cases rely on this
metadata heavily.</p>
<p>Metadata should be accessible both for current versions and for all historical
versions that may be in use.</p>
<p class="plantuml">
<object data="../_images/plantuml-3cecaf9749b5f509a5ab6657178d31b8c24a6ad7.svg" type="image/svg+xml" style="width:732px;height:319px;">
<img src="../_images/plantuml-3cecaf9749b5f509a5ab6657178d31b8c24a6ad7.png" alt="scale 0.60
left to right direction

:Smart Contract Developer: as :SmartContractDev:

rectangle Metadata {
  (Read contract instance info) as (ReadContractInstance)
  (Read contract type info) as (ReadContractType)
  (Read historical contract instance type info) as (ReadHistoricalInstanceType)

  (Read instance) as (ReadInstanceData)
  (Read type) as (ReadTypeData)

  ReadInstanceData &lt;|.up. ReadContractInstance
  ReadTypeData &lt;|.up.. ReadContractType
  ReadTypeData &lt;|.up.. ReadHistoricalInstanceType

  ' both
  (Read name) as (ReadName)
  (Read ABI) as (ReadABI)
  (Read bytecodes) as (ReadBytecodes)
  (Read source mappings) as (ReadSourceMaps)
  (Read link values) as (ReadLinkVals)
  (Read sources) as (ReadSources)
  (Read ASTs) as (ReadASTs)

  ' instance
  (Read link references) as (ReadLinkRefs)
  (Read address) as (ReadAddress)

  ReadTypeData --&gt; ReadName
  ReadTypeData --&gt; ReadABI
  ReadTypeData --&gt; ReadBytecodes
  ReadTypeData --&gt; ReadSourceMaps
  ReadTypeData --&gt; ReadLinkRefs
  ReadTypeData --&gt; ReadSources
  ReadTypeData --&gt; ReadASTs

  ReadInstanceData --&gt; ReadTypeData
  ReadInstanceData --&gt; ReadLinkVals
  ReadInstanceData --&gt; ReadAddress
}

SmartContractDev -- ReadContractInstance
SmartContractDev -- ReadContractType
SmartContractDev -- ReadHistoricalInstanceType" />

</object></p>
<div class="section" id="read-contract-instance-information">
<h2>3.1. Read contract instance information<a class="headerlink" href="#read-contract-instance-information" title="Permalink to this headline">¶</a></h2>
<p>Users must be able to read <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> metadata, including ABI, any
link values, and all type-level metadata for that instance.</p>
</div>
<div class="section" id="read-contract-type-info">
<h2>3.2. Read contract type info<a class="headerlink" href="#read-contract-type-info" title="Permalink to this headline">¶</a></h2>
<p>Users must be able to read metadata about a <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a> that has not been
deployed, as well as type-level metadata for a given <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a>.</p>
</div>
<div class="section" id="read-contract-instance-historical-type-info">
<h2>3.3. Read contract instance historical type info<a class="headerlink" href="#read-contract-instance-historical-type-info" title="Permalink to this headline">¶</a></h2>
<p>If the <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> has a type that is no longer the current version
in source, users should still be able to read that <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a> information,
for the type at deploy-time. This may differ from the current type version
arbitrarily: different source, different ABI, etc.</p>
</div>
</div>
<div class="section" id="querying-for-specific-contracts">
<h1>4. Querying for specific contracts<a class="headerlink" href="#querying-for-specific-contracts" title="Permalink to this headline">¶</a></h1>
<p>Developers must be able to view all known <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> on a given
network, or a list of networks with known instances of a given <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>.</p>
<p class="plantuml">
<object data="../_images/plantuml-a124047e0f2c865634064e09ddbe5afedaf6179e.svg" type="image/svg+xml" style="width:623px;height:662px;">
<img src="../_images/plantuml-a124047e0f2c865634064e09ddbe5afedaf6179e.png" alt="left to right direction
:Smart Contract Developer: as :Developer:

rectangle Querying {
  (Query known instances on a given network) as (QueryNetwork)
  (Query all networks for a given type) as (QueryType)
  (Query all networks for instances with a given role) as (QueryInstance)
  (Query for instance by network and address) as (QueryAddress)
  (Query all contracts with a given bytecode) as (QueryBytecode)
  (Query for bytecode ignoring link references) as (QueryBytecodeUnlinked)

  QueryInstance .|&gt; QueryType
  QueryBytecodeUnlinked .|&gt; QueryBytecode
}

Developer -- QueryNetwork
Developer -- QueryType
Developer -- QueryInstance
Developer -- QueryAddress
Developer -- QueryBytecode" />

</object></p>
<div class="section" id="query-for-instance-by-network-and-address">
<h2>4.1. Query for instance by network and address<a class="headerlink" href="#query-for-instance-by-network-and-address" title="Permalink to this headline">¶</a></h2>
<p>Users must be able to look up known <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> given a <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>
and an <a class="reference internal" href="../glossary.html#term-address"><span class="xref std std-term">Address</span></a>.</p>
</div>
<div class="section" id="query-all-contracts-with-a-given-bytecode">
<h2>4.2. Query all contracts with a given bytecode<a class="headerlink" href="#query-all-contracts-with-a-given-bytecode" title="Permalink to this headline">¶</a></h2>
<p>Because it is immutable, contract <a class="reference internal" href="../glossary.html#term-bytecode"><span class="xref std std-term">Bytecode</span></a> serves as a reliable secondary
index for both <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> and <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a>. Users should be able to
find all known <a class="reference internal" href="../glossary.html#term-contract"><span class="xref std std-term">Contracts</span></a> based on the raw hexadecimal representation of
EVM machine code.</p>
</div>
<div class="section" id="query-for-bytecode-ignoring-link-references">
<h2>4.3. Query for bytecode ignoring link references<a class="headerlink" href="#query-for-bytecode-ignoring-link-references" title="Permalink to this headline">¶</a></h2>
<p>Two sets of contract <a class="reference internal" href="../glossary.html#term-bytecode"><span class="xref std std-term">Bytecode</span></a> can differ only by <a class="reference internal" href="../glossary.html#term-link-value"><span class="xref std std-term">Link Values</span></a>. Users should
be able to query for all <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a> and <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> matching
a given bytecode, whether or not the <a class="reference internal" href="../glossary.html#term-link-reference"><span class="xref std std-term">Link References</span></a> have values or match.</p>
</div>
<div class="section" id="query-known-instances-on-a-given-network">
<h2>4.4. Query known instances on a given network<a class="headerlink" href="#query-known-instances-on-a-given-network" title="Permalink to this headline">¶</a></h2>
<p>Users should be able to see, at a glance, all <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> on a given
<a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>. This can be useful for validating migration state, or for easy
listing of address / ABI information, to present/share externally.</p>
</div>
<div class="section" id="query-all-networks-for-a-given-type">
<h2>4.5. Query all networks for a given type<a class="headerlink" href="#query-all-networks-for-a-given-type" title="Permalink to this headline">¶</a></h2>
<p>Developers often write applications so that each <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a> has a singleton
deployed <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a>. Tooling should enable this first-class nature of
contract types, and users should be able to track the various instances across
all known <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Networks</span></a>.</p>
<p>This is particularly useful when creating front-end applications, referencing
instances across networks with a single type description.</p>
</div>
<div class="section" id="query-all-networks-for-instances-with-a-given-role">
<h2>4.6. Query all networks for instances with a given role<a class="headerlink" href="#query-all-networks-for-instances-with-a-given-role" title="Permalink to this headline">¶</a></h2>
<p>In cases where a particular <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a> is not deployed as a singleton,
tooling should provide a mechanism by which users can deploy multiple
<a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a>, identified in some way distinct from type (i.e., <em>role</em>)</p>
<p>As a result, users should be able to use this distinct identifier to query
for analogous instances across <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Networks</span></a>, instead of relying solely on the
type.</p>
</div>
</div>
<div class="section" id="interacting-with-deployed-instances">
<h1>5. Interacting with deployed instances<a class="headerlink" href="#interacting-with-deployed-instances" title="Permalink to this headline">¶</a></h1>
<p>Besides metadata information, users must be able to retrieve runtime state
information about <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> and to be able to write to those
instances over the network.</p>
<p class="plantuml">
<object data="../_images/plantuml-f91ce914456d56f36af23c467d23713a49b9e03d.svg" type="image/svg+xml" style="width:561px;height:304px;">
<img src="../_images/plantuml-f91ce914456d56f36af23c467d23713a49b9e03d.png" alt="left to right direction

:User: as :User:

rectangle Metadata &lt;&lt; external &gt;&gt; {
  (Read ABI) as (ReadABI)
  (Read instance) as (ReadInstance)
  (ReadInstance) -&gt; ReadABI
}

rectangle Interaction {
  (Call read-only method) as (Call)
  (Invoke method via a transaction) as (SendTransaction)
  (Send ETH to a contract instance) as (Send)

  Call --&gt; ReadInstance
  SendTransaction --&gt; ReadInstance
}

User -- Call
User -- SendTransaction
User -- Send" />

</object></p>
<div class="section" id="call-read-only-method">
<h2>5.1. Call read-only method<a class="headerlink" href="#call-read-only-method" title="Permalink to this headline">¶</a></h2>
<p>Almost every smart contract provides mechanisms for viewing information
about a <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a>’s current state, including public storage variables
and computed data views. These interfaces are specified for each instance’s
<a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>, and described in its <a class="reference internal" href="../glossary.html#term-abi"><span class="xref std std-term">ABI</span></a>.</p>
<p>Users must be able to call these read-only methods and obtain their results.</p>
</div>
<div class="section" id="invoke-method-via-a-transaction">
<h2>5.2. Invoke method via a transaction<a class="headerlink" href="#invoke-method-via-a-transaction" title="Permalink to this headline">¶</a></h2>
<p>Similarly to calls, most contracts provide interface methods for modifying
<a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> state. Users must be able to execute the allowable
“write” operations for a contract instance.</p>
</div>
<div class="section" id="send-eth-to-a-contract-instance">
<h2>5.3. Send ETH to a contract instance<a class="headerlink" href="#send-eth-to-a-contract-instance" title="Permalink to this headline">¶</a></h2>
<p>Many smart contracts expose methods for receiving payment in the form or ether
or other tokens.</p>
<p>Developers must be able to test the receipt of ether; business stakeholders may
have to provide initial funds, for applications that require it.</p>
</div>
</div>
<div class="section" id="linking-contracts-to-libraries">
<h1>6. Linking contracts to libraries<a class="headerlink" href="#linking-contracts-to-libraries" title="Permalink to this headline">¶</a></h1>
<p>Smart contract development best practices encourage the separation of code
into multiple discrete components. As such, developers may write contracts that
leverage the use of <a class="reference internal" href="../glossary.html#term-library"><span class="xref std std-term">Libraries</span></a> to provide composed behavior.</p>
<p><a class="reference internal" href="../glossary.html#term-contract"><span class="xref std std-term">Contracts</span></a> using libraries are compiled with unresolved <a class="reference internal" href="../glossary.html#term-link-reference"><span class="xref std std-term">Link References</span></a>.
Libraries are deployed as their own instances and later filled in for the
<a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a> as a corresponding <a class="reference internal" href="../glossary.html#term-link-value"><span class="xref std std-term">Link Value</span></a>.</p>
<p class="plantuml">
<object data="../_images/plantuml-fe8ff77adc8e5ea2849d6160149d7a33b3bb260c.svg" type="image/svg+xml" style="width:749px;height:226px;">
<img src="../_images/plantuml-fe8ff77adc8e5ea2849d6160149d7a33b3bb260c.png" alt="left to right direction

:Smart Contract Developer: as :Developer:

rectangle Saving &lt;&lt; external &gt;&gt; {
  (Save contract type) as (SaveType)
  (Save contract instance) as (SaveInstance)
}

rectangle Linking {
  (Link contract type to library) as (LinkType)
  (Link contract instance to library) as (LinkInstance)
  LinkInstance .left.|&gt; LinkType

  LinkType --&gt; SaveType
  LinkInstance --&gt; SaveInstance
}

Developer -- LinkType
Developer -- LinkInstance" />

</object></p>
<div class="section" id="link-contract-type-to-library-instance">
<h2>6.1. Link contract type to library instance<a class="headerlink" href="#link-contract-type-to-library-instance" title="Permalink to this headline">¶</a></h2>
<p>Developers must be able to link <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a> to corresponding <a class="reference internal" href="../glossary.html#term-library"><span class="xref std std-term">Libraries</span></a>
on a particular <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a> or for all networks, so that deployments of that
type are pre-linked.</p>
</div>
<div class="section" id="link-contract-instance-to-library-instance">
<h2>6.2. Link contract instance to library instance<a class="headerlink" href="#link-contract-instance-to-library-instance" title="Permalink to this headline">¶</a></h2>
<p>In cases where a <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> is already deployed, but the
<a class="reference internal" href="../glossary.html#term-link-reference"><span class="xref std std-term">Link Reference</span></a> for any <a class="reference internal" href="../glossary.html#term-library"><span class="xref std std-term">Library</span></a> is not known, developers should be able to
save the <a class="reference internal" href="../glossary.html#term-link-value"><span class="xref std std-term">Link Value</span></a>.</p>
</div>
</div>
<div class="section" id="deploying-new-instances">
<h1>7. Deploying new instances<a class="headerlink" href="#deploying-new-instances" title="Permalink to this headline">¶</a></h1>
<p>During and after the process of creating smart contracts, smart contract
developers need to deploy <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a> on one or more <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Networks</span></a>, creating
one or more <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a>.</p>
<p class="plantuml">
<object data="../_images/plantuml-7f357569926af20c8b2832c118a56b637e020a0a.svg" type="image/svg+xml" style="width:717px;height:227px;">
<img src="../_images/plantuml-7f357569926af20c8b2832c118a56b637e020a0a.png" alt="left to right direction

:Smart Contract Developer: as :Developer:

rectangle Saving &lt;&lt; external &gt;&gt; {
  (Save contract instance) as (SaveInstance)
}

rectangle Deployment {
  (Deploy instance of a type) as (DeployInstance)
  (Deploy multiple instances) as (MultipleInstances)
  MultipleInstances .|&gt; DeployInstance
  DeployInstance --&gt; SaveInstance
}

Developer -- DeployInstance
Developer -- MultipleInstances" />

</object></p>
<div class="section" id="deploy-instance-of-a-type">
<h2>7.1. Deploy instance of a type<a class="headerlink" href="#deploy-instance-of-a-type" title="Permalink to this headline">¶</a></h2>
<p>The base case for deployment: given a <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>, users must be able to
deploy a new <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> on a particular <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>.</p>
</div>
<div class="section" id="deploy-multiple-instances">
<h2>7.2. Deploy multiple instances<a class="headerlink" href="#deploy-multiple-instances" title="Permalink to this headline">¶</a></h2>
<p>For applications that require multiple <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> per <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>,
users should be able to deploy instances by role or other identifier.</p>
</div>
</div>
<div class="section" id="migrations">
<h1>8. Migrations<a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h1>
<p>Smart contract developers should be able to track the states of
different <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Networks</span></a> separately. <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a> on different
networks can be of different versions of the same <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>. This
difference should be understood by the underlying tooling, and easy to
reason about for the user of the tool.</p>
<p class="plantuml">
<object data="../_images/plantuml-9ac792f44a4ff7a473f3c8e4b30c7bd66c8869b3.svg" type="image/svg+xml" style="width:648px;height:301px;">
<img src="../_images/plantuml-9ac792f44a4ff7a473f3c8e4b30c7bd66c8869b3.png" alt="scale 0.55
left to right direction

:Smart Contract Developer: as :Developer:

rectangle Querying &lt;&lt; external &gt;&gt; {
  (Query for a given type) as (QueryType)
}

rectangle Interacting &lt;&lt; external &gt;&gt; {
  (Call read-only method) as (Call)
}

rectangle Linking &lt;&lt; external &gt;&gt; {
  (Link contract type to library) as (LinkType)
}

rectangle Deployment &lt;&lt; external &gt;&gt; {
  (Deploy instance of a type) as (DeployInstance)
}

rectangle Migrations {
  (Run all migrations) as (RunMigrations)
  (Run specific migration) as (RunSpecific)
  (Run as historical) as (RunHistorical)
  (Determine last completed migration) as (DetermineLastCompleted)


  RunHistorical ..|&gt; RunMigrations

  RunMigrations -right-&gt; RunSpecific
  RunMigrations -left-&gt; DetermineLastCompleted

  DetermineLastCompleted -down-&gt; QueryType : find deployed Migrations
  DetermineLastCompleted -down-&gt; Call : read instance state
  RunSpecific -down-&gt; DeployInstance
  RunSpecific -down-&gt; LinkType


}

Developer -- RunMigrations
Developer -- RunSpecific
Developer -- RunHistorical
Developer -- DetermineLastCompleted" />

</object></p>
<div class="section" id="determine-last-completed-migration">
<h2>8.1. Determine last completed migration<a class="headerlink" href="#determine-last-completed-migration" title="Permalink to this headline">¶</a></h2>
<p>Querying and reading the on-chain <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> for the <code class="docutils literal notranslate"><span class="pre">Migrations</span></code>
contract, users should be able to determine the most recently completed
migration on that <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>.</p>
</div>
<div class="section" id="run-all-migrations">
<h2>8.2. Run all migrations<a class="headerlink" href="#run-all-migrations" title="Permalink to this headline">¶</a></h2>
<p>Either starting at the last completed migration, or resetting from the
beginning, users should be able to run all migrations for a <a class="reference internal" href="../glossary.html#term-project"><span class="xref std std-term">Project</span></a> on
a particular <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>.</p>
</div>
<div class="section" id="run-specific-migration">
<h2>8.3. Run specific migration<a class="headerlink" href="#run-specific-migration" title="Permalink to this headline">¶</a></h2>
<p>As part of the larger use case of running all migrations, or as a standalone
operation. Users and tooling must support running a single migration.</p>
</div>
<div class="section" id="run-with-historical-types">
<h2>8.4. Run with historical types<a class="headerlink" href="#run-with-historical-types" title="Permalink to this headline">¶</a></h2>
<p>Specifying parent network, users should be able to mimic the state of a given
network, determining <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Types</span></a> for all known <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instances</span></a>, and
deploy new instances matching those types instead of current.</p>
</div>
</div>
<div class="section" id="testing-smart-contracts">
<h1>9. Testing smart contracts<a class="headerlink" href="#testing-smart-contracts" title="Permalink to this headline">¶</a></h1>
<p>Being able to validate that smart contracts behave as expected is of paramount
importance.</p>
<p>Development workflow best practices involve writing/running automated tests
early and often in the process. Developers should be able to test their
contracts locally before deployment, and once deployed, be able to test their
contract instances locally, matching expected behavior on the network itself.</p>
<p class="plantuml">
<object data="../_images/plantuml-f9f066ddfc15b186b2012bd413c02a817cd74ede.svg" type="image/svg+xml" style="width:732px;height:287px;">
<img src="../_images/plantuml-f9f066ddfc15b186b2012bd413c02a817cd74ede.png" alt="scale 0.65
left to right direction

:Smart Contract Developer: as :Developer:


rectangle Compilation &lt;&lt; external &gt;&gt; {
  (Compile all project sources) as (CompileAll)
}

rectangle Migrations &lt;&lt; external &gt;&gt; {
  (Run all migrations) as (RunMigrations)
  (Run as historical) as (RunHistorical)
  RunHistorical .|&gt; RunMigrations
}

rectangle Testing {
  (Run automated tests for contract type) as (TestType)
  (Run automated tests for contract instance) as (TestInstance)
  (Run automated tests for library type) as (TestLibrary)
  (Run automated tests for library instance) as (TestLibraryInstance)

  TestInstance --&gt; RunHistorical
  TestLibraryInstance --&gt; RunHistorical

  (Run test written in Solidity) as (RunSolidity)
  RunSolidity --&gt; CompileAll
  RunSolidity --&gt; RunMigrations

  (Run test written in Javascript) as (RunJavascript)
  RunJavascript --&gt; CompileAll
  RunJavascript --&gt; RunMigrations

  TestType --&gt; RunSolidity
  TestType --&gt; RunJavascript

  TestInstance --&gt; RunSolidity
  TestInstance --&gt; RunJavascript

  TestLibrary --&gt; RunSolidity
  TestLibraryInstance --&gt; RunSolidity
}

Developer -- TestType
Developer -- TestInstance
Developer -- TestLibrary
Developer -- TestLibraryInstance" />

</object></p>
<div class="section" id="run-automated-tests-for-contract-type">
<h2>9.1. Run automated tests for contract type<a class="headerlink" href="#run-automated-tests-for-contract-type" title="Permalink to this headline">¶</a></h2>
<p>Users must be able to run the full test suite for a given <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>,
written in either Solidity or Javascript, starting fresh on a given <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>
and running all compilation/migration steps in the process.</p>
</div>
<div class="section" id="run-automated-tests-for-contract-instance">
<h2>9.2. Run automated tests for contract instance<a class="headerlink" href="#run-automated-tests-for-contract-instance" title="Permalink to this headline">¶</a></h2>
<p>Some tests may be written for a specific <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a> to account for
historical differences between that instance and the current
<a class="reference internal" href="../glossary.html#term-source"><span class="xref std std-term">Source</span></a> for the corresponding <a class="reference internal" href="../glossary.html#term-contract-type"><span class="xref std std-term">Contract Type</span></a>.</p>
<p>Users should be able run tests on a fresh local <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a>, reflecting that
historical version.</p>
</div>
<div class="section" id="run-automated-tests-for-library-type">
<h2>9.3. Run automated tests for library type<a class="headerlink" href="#run-automated-tests-for-library-type" title="Permalink to this headline">¶</a></h2>
<p>In order to validate a particular <a class="reference internal" href="../glossary.html#term-library"><span class="xref std std-term">Library</span></a>, users should be able to run
tests in a fresh local <a class="reference internal" href="../glossary.html#term-network"><span class="xref std std-term">Network</span></a> environment, with given library deployed.</p>
</div>
<div class="section" id="run-automated-tests-for-library-instance">
<h2>9.4. Run automated tests for library instance<a class="headerlink" href="#run-automated-tests-for-library-instance" title="Permalink to this headline">¶</a></h2>
<p>Much like running automated tests for a <a class="reference internal" href="../glossary.html#term-contract-instance"><span class="xref std std-term">Contract Instance</span></a>, users should be
able to validate behavior for outdated instances of a given <a class="reference internal" href="../glossary.html#term-library"><span class="xref std std-term">Library</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Truffle Suite.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>